# 铃鲜好物 - 项目架构文档

## 项目概述

铃鲜好物是一个多商户社区买菜小程序平台，主要服务于周边社区小区的网上买菜和预约送货上门业务。

### 项目特点
- 多商户入驻，支持独立店铺管理
- 用户在线购买、拼团优惠
- 预约配送、送货上门
- 积分体系、营销活动

## 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户端                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │
│  │ 用户小程序  │  │ 商户小程序  │  │    后台管理系统(PC)     │ │
│  │  (微信)     │  │  (微信)     │  │    (Vue3+Element)       │ │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        API 网关                                  │
│                    (Nginx / 负载均衡)                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      后端服务层                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                Spring Boot Application                      ││
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           ││
│  │  │用户模块 │ │商户模块 │ │商品模块 │ │订单模块 │           ││
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘           ││
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           ││
│  │  │拼团模块 │ │支付模块 │ │积分模块 │ │系统模块 │           ││
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘           ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        数据层                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  PostgreSQL  │  │    Redis     │  │    MinIO     │          │
│  │   (主数据库) │  │   (缓存)     │  │  (文件存储)  │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
```

## 技术栈

### 后端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| Spring Boot | 3.2.x | 基础框架 |
| MyBatis Plus | 3.5.x | ORM框架 |
| PostgreSQL | 15+ | 主数据库 |
| Redis | 7.0+ | 缓存/分布式锁 |
| JWT | - | 身份认证 |
| WxJava | 4.6.x | 微信SDK |
| MinIO | - | 对象存储 |
| Knife4j | 4.4.x | API文档 |

### 前端技术栈
| 项目 | 技术栈 |
|------|--------|
| 用户小程序 | 微信原生 + WXML/WXSS/JS |
| 商户小程序 | 微信原生 + WXML/WXSS/JS |
| 后台管理 | Vue3 + Vite + Element Plus + Pinia |

## 目录结构

```
lingxian-haowu/
├── lingxian-server/          # 后端服务
│   ├── src/main/java/
│   │   └── com/lingxian/haowu/
│   │       ├── config/       # 配置类
│   │       ├── controller/   # 控制器
│   │       │   ├── admin/    # 管理端API
│   │       │   ├── merchant/ # 商户端API
│   │       │   └── user/     # 用户端API
│   │       ├── service/      # 业务服务
│   │       ├── mapper/       # 数据访问
│   │       ├── entity/       # 实体类
│   │       ├── dto/          # 数据传输对象
│   │       ├── vo/           # 视图对象
│   │       ├── common/       # 公共组件
│   │       └── security/     # 安全认证
│   └── src/main/resources/
│       ├── application.yml   # 应用配置
│       └── mapper/           # MyBatis映射
│
├── lingxian-user-miniapp/    # 用户端小程序
│   ├── pages/                # 页面
│   ├── components/           # 组件
│   ├── api/                  # API接口
│   ├── utils/                # 工具类
│   └── static/               # 静态资源
│
├── lingxian-merchant-miniapp/# 商户端小程序
│   ├── pages/                # 页面
│   ├── components/           # 组件
│   ├── api/                  # API接口
│   ├── utils/                # 工具类
│   └── static/               # 静态资源
│
├── lingxian-admin/           # 后台管理系统
│   ├── src/
│   │   ├── api/              # API接口
│   │   ├── assets/           # 静态资源
│   │   ├── components/       # 公共组件
│   │   ├── layouts/          # 布局组件
│   │   ├── router/           # 路由配置
│   │   ├── store/            # 状态管理
│   │   ├── views/            # 页面视图
│   │   └── utils/            # 工具类
│   └── public/               # 公共资源
│
└── docs/                     # 项目文档
    ├── api/                  # API文档
    ├── database/             # 数据库文档
    ├── architecture/         # 架构文档
    └── deploy/               # 部署文档
```

## 核心功能模块

### 1. 用户模块
- 微信登录授权
- 用户信息管理
- 收货地址管理
- 积分管理

### 2. 商户模块
- 商户入驻申请
- 店铺信息管理
- 商品管理
- 订单管理
- 配送管理
- 数据统计

### 3. 商品模块
- 商品分类管理
- 商品信息管理
- 库存管理
- 商品搜索

### 4. 订单模块
- 购物车管理
- 订单创建
- 订单支付
- 订单状态流转
- 配送管理
- 退款处理

### 5. 拼团模块
- 拼团活动管理
- 发起拼团
- 参与拼团
- 拼团成功/失败处理

### 6. 积分模块
- 签到获取积分
- 消费获取积分
- 积分抵扣
- 积分记录

### 7. 营销模块
- 轮播图管理
- 推荐商品
- 活动配置

## API设计

### API路由规划
```
/api
├── /user           # 用户端API
│   ├── /auth       # 认证相关
│   ├── /home       # 首页数据
│   ├── /products   # 商品相关
│   ├── /cart       # 购物车
│   ├── /orders     # 订单相关
│   ├── /groups     # 拼团相关
│   ├── /addresses  # 地址相关
│   └── /points     # 积分相关
│
├── /merchant       # 商户端API
│   ├── /auth       # 认证相关
│   ├── /dashboard  # 工作台
│   ├── /products   # 商品管理
│   ├── /orders     # 订单管理
│   ├── /deliveries # 配送管理
│   ├── /statistics # 数据统计
│   └── /shop       # 店铺设置
│
└── /admin          # 管理端API
    ├── /auth       # 认证相关
    ├── /users      # 用户管理
    ├── /merchants  # 商户管理
    ├── /products   # 商品管理
    ├── /orders     # 订单管理
    ├── /groups     # 拼团管理
    ├── /banners    # 轮播图管理
    ├── /statistics # 数据统计
    └── /system     # 系统管理
```

## 数据库设计

### 核心表结构
| 表名 | 说明 |
|------|------|
| t_user | 用户表 |
| t_user_address | 用户收货地址表 |
| t_merchant | 商户表 |
| t_category | 商品分类表 |
| t_product | 商品表 |
| t_cart | 购物车表 |
| t_order | 订单表 |
| t_order_item | 订单商品项表 |
| t_group_activity | 拼团活动表 |
| t_group_record | 拼团记录表 |
| t_group_participant | 拼团参与者表 |
| t_points_record | 积分记录表 |
| t_banner | 轮播图表 |
| t_admin_user | 管理员表 |
| t_role | 角色表 |
| t_system_config | 系统配置表 |

详细表结构请参考 `/docs/database/schema.sql`

## 部署架构

### 推荐部署方案
```
┌─────────────────────────────────────────────┐
│                  云服务器                    │
│  ┌─────────────────────────────────────────┐│
│  │  Nginx (反向代理 + 静态资源)            ││
│  │  - 后台管理系统静态文件                 ││
│  │  - API代理到后端服务                    ││
│  └─────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────┐│
│  │  Docker                                 ││
│  │  ├── lingxian-server (Spring Boot)     ││
│  │  ├── PostgreSQL                        ││
│  │  ├── Redis                              ││
│  │  └── MinIO                              ││
│  └─────────────────────────────────────────┘│
└─────────────────────────────────────────────┘
```

### 环境要求
- JDK 17+
- Node.js 18+
- PostgreSQL 15+
- Redis 7.0+
- Docker (可选)

## 开发指南

### 后端开发
```bash
# 进入后端目录
cd lingxian-server

# 安装依赖并运行
mvn spring-boot:run
```

### 前端开发
```bash
# 后台管理系统
cd lingxian-admin
npm install
npm run dev
```

### 小程序开发
使用微信开发者工具打开对应目录:
- 用户端: `lingxian-user-miniapp`
- 商户端: `lingxian-merchant-miniapp`

## 配置说明

### 环境变量
| 变量名 | 说明 | 默认值 |
|--------|------|--------|
| DB_PASSWORD | 数据库密码 | - |
| REDIS_PASSWORD | Redis密码 | - |
| JWT_SECRET | JWT密钥 | - |
| WX_USER_APPID | 用户小程序AppID | - |
| WX_USER_SECRET | 用户小程序Secret | - |
| WX_MERCHANT_APPID | 商户小程序AppID | - |
| WX_MERCHANT_SECRET | 商户小程序Secret | - |
| MINIO_ENDPOINT | MinIO地址 | http://localhost:9000 |

## 版本规划

### v1.0.0 (MVP)
- [x] 基础用户系统
- [x] 商户入驻管理
- [x] 商品管理
- [x] 订单系统
- [x] 微信支付
- [x] 基础后台管理

### v1.1.0
- [ ] 拼团功能
- [ ] 积分系统
- [ ] 优惠券系统

### v1.2.0
- [ ] 配送员App
- [ ] 实时消息推送
- [ ] 评价系统

## 贡献指南

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

## 许可证

本项目采用 MIT 许可证
